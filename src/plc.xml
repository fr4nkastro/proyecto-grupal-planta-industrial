<?xml version='1.0' encoding='utf-8'?>
<project xmlns="http://www.plcopen.org/xml/tc6_0201" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:ns1="http://www.plcopen.org/xml/tc6_0201">
  <fileHeader companyName="Unknown" productName="Unnamed" productVersion="1" creationDateTime="2025-03-16T15:34:21"/>
  <contentHeader name="Proyecto" modificationDateTime="2025-04-12T18:43:47">
    <coordinateInfo>
      <fbd>
        <scaling x="10" y="10"/>
      </fbd>
      <ld>
        <scaling x="10" y="10"/>
      </ld>
      <sfc>
        <scaling x="10" y="10"/>
      </sfc>
    </coordinateInfo>
  </contentHeader>
  <types>
    <dataTypes>
      <dataType name="FSM1_TSTATUS">
        <baseType>
          <enum>
            <values>
              <value name="FSM1_ESPERA"/>
              <value name="FSM1_ARRANCANDO_BANDAS"/>
              <value name="FSM1_ESPERANDO_CLASIFICACION"/>
              <value name="FSM1_ESPERANDO_DETECCION_PIEZA"/>
              <value name="FSM1_CLAMPEANDO"/>
              <value name="FSM1_RECOGIENDO_PIEZA_SUCCIONADOR1"/>
            </values>
          </enum>
        </baseType>
      </dataType>
      <dataType name="FSM1_TRANSITIONS">
        <baseType>
          <enum>
            <values>
              <value name="FSM1_INICIAR"/>
              <value name="FSM1_DESHABILITADO"/>
              <value name="FSM1_CLASIFICAR_CAJAS_COLOR"/>
              <value name="FSM1_DETECTAR_PIEZA_EMPUJAR"/>
              <value name="FSM1_CLAMPEAR"/>
              <value name="FSM1_RECOGER_PIEZA_SUCCIONADOR1"/>
            </values>
          </enum>
        </baseType>
      </dataType>
      <dataType name="FSM2_TSTATUS">
        <baseType>
          <enum>
            <values>
              <value name="FSM2_NULLL"/>
              <value name="FSM2_VALIDANDO_TRANSACCION"/>
              <value name="FSM2_INICIANDO_SECUENCIA"/>
            </values>
          </enum>
        </baseType>
      </dataType>
      <dataType name="FSM2_TTRANSITIONS">
        <baseType>
          <enum>
            <values>
              <value name="FSM2_DESHABILITADO"/>
              <value name="FSM2_INICIAR_SECUENCIA"/>
              <value name="FSM2_DETECTAR_PALLET"/>
            </values>
          </enum>
        </baseType>
      </dataType>
    </dataTypes>
    <pous>
      <pou name="main" pouType="program">
        <interface>
          <localVars>
            <variable name="FSM1_Petri0">
              <type>
                <derived name="FSM1_Petri"/>
              </type>
            </variable>
            <variable name="FSM1_Triggers0">
              <type>
                <derived name="FSM1_Triggers"/>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <LD>
            <block localId="4" typeName="FSM1_Petri" instanceName="FSM1_Petri0" width="100" height="20">
              <position x="140" y="100"/>
              <inputVariables/>
              <inOutVariables/>
              <outputVariables/>
            </block>
            <block localId="5" typeName="FSM1_Triggers" instanceName="FSM1_Triggers0" width="120" height="20">
              <position x="340" y="120"/>
              <inputVariables/>
              <inOutVariables/>
              <outputVariables/>
            </block>
          </LD>
        </body>
      </pou>
      <pou name="FSM1_Petri" pouType="functionBlock">
        <interface>
          <externalVars>
            <variable name="FSM1_CurrentTransition">
              <type>
                <derived name="FSM1_TRANSITIONS"/>
              </type>
            </variable>
            <variable name="FSM1_CurrentStatus">
              <type>
                <derived name="FSM1_TSTATUS"/>
              </type>
            </variable>
          </externalVars>
        </interface>
        <body>
          <ST>
            <xhtml:p><![CDATA[(*Red FSM1_Petri*)
IF FSM1_CurrentTransition = FSM1_INICIAR 
  THEN
    FSM1_CurrentStatus:=FSM1_ARRANCANDO_BANDAS;
END_IF;

IF FSM1_CurrentTransition = FSM1_CLASIFICAR_CAJAS_COLOR 
  THEN
    FSM1_CurrentStatus:=FSM1_ESPERANDO_CLASIFICACION;
END_IF;

IF FSM1_CurrentTransition = FSM1_DETECTAR_PIEZA_EMPUJAR
    THEN
      FSM1_CurrentStatus:=FSM1_ESPERANDO_DETECCION_PIEZA;
END_IF;

IF FSM1_CurrentTransition = FSM1_CLAMPEAR
    THEN
      FSM1_CurrentStatus:=FSM1_CLAMPEANDO;
END_IF;

IF FSM1_CurrentTransition = FSM1_RECOGER_PIEZA_SUCCIONADOR1
  THEN
      FSM1_CurrentStatus:=FSM1_RECOGIENDO_PIEZA_SUCCIONADOR1;
END_IF;
]]></xhtml:p>
          </ST>
        </body>
      </pou>
      <pou name="FSM1_Triggers" pouType="functionBlock">
        <interface>
          <externalVars>
            <variable name="FSM1_CurrentStatus">
              <type>
                <derived name="FSM1_TSTATUS"/>
              </type>
            </variable>
            <variable name="FSM1_CurrentTransition">
              <type>
                <derived name="FSM1_TRANSITIONS"/>
              </type>
            </variable>
          </externalVars>
          <localVars>
            <variable name="FSM1_FTrigStop">
              <type>
                <derived name="F_TRIG"/>
              </type>
            </variable>
          </localVars>
          <externalVars>
            <variable name="FSM1_RCSorting1">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_RCSorting2">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_RCSorting3">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_RCSorting4">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_RCSorting5">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_RCSorting6">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_RCSorting7">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_RCSorting8">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_RCSorting9">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_BtnStop">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_BtnStart">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_SensorVision1">
              <type>
                <INT/>
              </type>
            </variable>
          </externalVars>
          <localVars>
            <variable name="SensorVision1Value">
              <type>
                <INT/>
              </type>
            </variable>
          </localVars>
          <externalVars>
            <variable name="FSM1_SensorPusher1">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_SensorPusher2">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_PusherSorting1">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_PusherSorting2">
              <type>
                <BOOL/>
              </type>
            </variable>
          </externalVars>
          <localVars>
            <variable name="TP_Pusher1">
              <type>
                <derived name="TP"/>
              </type>
            </variable>
            <variable name="TP_Pusher2">
              <type>
                <derived name="TP"/>
              </type>
            </variable>
          </localVars>
          <externalVars>
            <variable name="FSM1_RCGreen">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_RCBlue">
              <type>
                <BOOL/>
              </type>
            </variable>
          </externalVars>
          <localVars>
            <variable name="FTRIG_Pusher1">
              <type>
                <derived name="F_TRIG"/>
              </type>
            </variable>
            <variable name="FTRIG_Pusher2">
              <type>
                <derived name="F_TRIG"/>
              </type>
            </variable>
            <variable name="FTRIG_SensorClampBlue">
              <type>
                <derived name="F_TRIG"/>
              </type>
            </variable>
          </localVars>
          <externalVars>
            <variable name="FSM1_SensorClampBlue">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_SensorClampGreen">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_OutClampBlue">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="FSM1_OutClampGreen">
              <type>
                <BOOL/>
              </type>
            </variable>
          </externalVars>
          <localVars>
            <variable name="TP_ClampBlue">
              <type>
                <derived name="TP"/>
              </type>
            </variable>
            <variable name="FTRIG_ClampBlue">
              <type>
                <derived name="F_TRIG"/>
              </type>
            </variable>
          </localVars>
          <externalVars>
            <variable name="BASE_BLUE">
              <type>
                <INT/>
              </type>
            </variable>
            <variable name="LID_BLUE">
              <type>
                <INT/>
              </type>
            </variable>
            <variable name="LID_GREEN">
              <type>
                <INT/>
              </type>
            </variable>
            <variable name="BASE_GREEN">
              <type>
                <INT/>
              </type>
            </variable>
          </externalVars>
          <localVars>
            <variable name="FTRIG_SensorClampGreen">
              <type>
                <derived name="F_TRIG"/>
              </type>
            </variable>
            <variable name="TP_ClampGreen">
              <type>
                <derived name="TP"/>
              </type>
            </variable>
            <variable name="FTRIG_ClampGreen">
              <type>
                <derived name="F_TRIG"/>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml:p><![CDATA[FSM1_FTrigStop(

     CLK := FSM1_BtnStop
);

IF FSM1_FTrigStop.Q THEN
  FSM1_CurrentTransition:=FSM1_DESHABILITADO;
  FSM1_CurrentStatus:= FSM1_ESPERA;
  SensorVision1Value:=0;
  FSM1_RCSorting1:=FALSE;
  FSM1_RCSorting2:=FALSE;
  FSM1_RCSorting3:=FALSE;
  FSM1_RCSorting4:=FALSE;
  FSM1_RCSorting5:=FALSE;
  FSM1_RCSorting6:=FALSE;
  FSM1_RCSorting7:=FALSE;
  FSM1_RCSorting8:=FALSE;
  FSM1_RCSorting9:=FALSE;
  FSM1_RCGreen:=FALSE;
  FSM1_RCBlue:=FALSE;
END_IF;

IF FSM1_CurrentStatus = FSM1_ESPERA
  THEN
  IF FSM1_BtnStart
    THEN
      FSM1_CurrentTransition:= FSM1_INICIAR;
  END_IF;
END_IF;

IF FSM1_CurrentStatus = FSM1_ARRANCANDO_BANDAS
  THEN
      FSM1_RCSorting1:=TRUE;
      FSM1_RCSorting2:=TRUE;
      FSM1_RCSorting3:=TRUE;
      FSM1_RCSorting4:=TRUE;
      FSM1_RCSorting5:=TRUE;
      FSM1_RCSorting6:=TRUE;
      FSM1_RCSorting7:=TRUE;
      FSM1_RCSorting8:=TRUE;
      FSM1_RCSorting9:=TRUE;
      FSM1_RCGreen:=TRUE;
      FSM1_RCBlue:=TRUE;
      SensorVision1Value:=0;
      FSM1_CurrentTransition:=FSM1_CLASIFICAR_CAJAS_COLOR;
END_IF;

IF FSM1_CurrentStatus = FSM1_ESPERANDO_CLASIFICACION 
  THEN
    IF FSM1_SensorVision1 > 0 THEN
      SensorVision1Value:= FSM1_SensorVision1;    
      FSM1_CurrentTransition := FSM1_DETECTAR_PIEZA_EMPUJAR;
    END_IF;
END_IF;

IF FSM1_CurrentStatus =FSM1_ESPERANDO_DETECCION_PIEZA 
    THEN
      IF  SensorVision1Value = LID_GREEN OR 
          SensorVision1Value = BASE_GREEN
      THEN
        TP_Pusher1(
         IN := FSM1_SensorPusher1,
         PT := T#2s,
         Q => FSM1_PusherSorting1
        );
        FTRIG_Pusher1(
            CLK := TP_Pusher1.Q
          );
        IF FTRIG_Pusher1.Q 

          THEN

           FSM1_CurrentTransition := FSM1_CLAMPEAR;

        END_IF;
      END_IF;
      
      IF  SensorVision1Value = LID_BLUE OR 
          SensorVision1Value = BASE_BLUE
        THEN
          TP_Pusher2(
           IN := FSM1_SensorPusher2,
           PT := T#2s,
           Q => FSM1_PusherSorting2
          );
          FTRIG_Pusher2(
            CLK:= TP_Pusher2.Q
          );
          IF FTRIG_Pusher2.Q 
            THEN
            FSM1_CurrentTransition := FSM1_CLAMPEAR;
          END_IF;
      END_IF;
      
END_IF;


IF FSM1_CurrentStatus = FSM1_CLAMPEANDO 
  THEN
    IF  SensorVision1Value = LID_BLUE OR 
          SensorVision1Value = BASE_BLUE
      THEN
      (*Detectar cuando la pieza ha pasado por completo el sensor*)
      FTRIG_SensorClampBlue(
         CLK := FSM1_SensorClampBlue
      );
      TP_ClampBlue(
         IN := FTRIG_SensorClampBlue.Q ,
         PT := T#1s,
         Q => FSM1_OutClampBlue
       );
      FTRIG_ClampBlue(
        CLK := TP_ClampBlue.Q
       );
      IF FTRIG_ClampBlue.Q THEN
        FSM1_CurrentTransition:=FSM1_RECOGER_PIEZA_SUCCIONADOR1;
      END_IF;
  END_IF;
  
  IF  SensorVision1Value = LID_GREEN OR 
          SensorVision1Value = BASE_GREEN
    THEN
      (*Detectar cuando la pieza ha pasado por completo el sensor*)
      FTRIG_SensorClampGreen(
         CLK := FSM1_SensorClampGreen
      );
      TP_ClampGreen(
         IN := FTRIG_SensorClampGreen.Q ,
         PT := T#1s,
         Q => FSM1_OutClampGreen
       );
      FTRIG_ClampGreen(
        CLK := TP_ClampGreen.Q
       );
      IF FTRIG_ClampGreen.Q THEN
        FSM1_CurrentTransition:=FSM1_RECOGER_PIEZA_SUCCIONADOR1;
      END_IF;
  END_IF;
  
  
  
END_IF;
      
      
          
            
]]></xhtml:p>
          </ST>
        </body>
      </pou>
    </pous>
  </types>
  <instances>
    <configurations>
      <configuration name="Config0">
        <resource name="Res0">
          <task name="task0" priority="0" interval="T#20ms">
            <pouInstance name="instance0" typeName="main"/>
          </task>
          <globalVars>
            <variable name="FSM1_CurrentStatus">
              <type>
                <derived name="FSM1_TSTATUS"/>
              </type>
              <initialValue>
                <simpleValue value="FSM1_ESPERA"/>
              </initialValue>
            </variable>
            <variable name="FSM1_CurrentTransition">
              <type>
                <derived name="FSM1_TRANSITIONS"/>
              </type>
              <initialValue>
                <simpleValue value="FSM1_DESHABILITADO"/>
              </initialValue>
            </variable>
            <variable name="FSM2_CurrentTransition">
              <type>
                <derived name="FSM2_TTRANSITIONS"/>
              </type>
              <initialValue>
                <simpleValue value="FSM2_DESHABILITADO"/>
              </initialValue>
            </variable>
            <variable name="FSM2_CurrentStatus">
              <type>
                <derived name="FSM2_TSTATUS"/>
              </type>
              <initialValue>
                <simpleValue value="FSM2_VALIDANDO_TRANSACCION"/>
              </initialValue>
            </variable>
            <variable name="FSM1_BtnStart" address="%IX100.0">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_BtnStop" address="%IX100.1">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="TRUE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_SensorPusher1" address="%IX100.2">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="TRUE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_SensorPusher2" address="%IX100.3">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="TRUE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_SensorClampBlue" address="%IX100.4">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="TRUE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_SensorClampGreen" address="%IX100.5">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="TRUE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_RCSorting1" address="%QX100.0">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_RCSorting2" address="%QX100.1">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_RCSorting3" address="%QX100.2">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_RCSorting4" address="%QX100.3">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_RCSorting5" address="%QX100.4">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_RCSorting6" address="%QX100.5">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_RCSorting7" address="%QX100.6">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_RCSorting8" address="%QX100.7">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_RCSorting9" address="%QX101.0">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_PusherSorting1" address="%QX101.1">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_PusherSorting2" address="%QX101.2">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_RcGreen" address="%QX101.3">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_RcBlue" address="%QX101.4">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_OutClampBlue" address="%QX101.5">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_OutClampGreen" address="%QX101.6">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="FSM1_SensorVision1" address="%IW100">
              <type>
                <INT/>
              </type>
              <initialValue>
                <simpleValue value="0"/>
              </initialValue>
            </variable>
            <variable name="FSM1_SensorVision2" address="%IW101">
              <type>
                <INT/>
              </type>
              <initialValue>
                <simpleValue value="0"/>
              </initialValue>
            </variable>
            <variable name="BASE_BLUE">
              <type>
                <INT/>
              </type>
              <initialValue>
                <simpleValue value="3"/>
              </initialValue>
            </variable>
            <variable name="BASE_GREEN">
              <type>
                <INT/>
              </type>
              <initialValue>
                <simpleValue value="6"/>
              </initialValue>
            </variable>
            <variable name="LID_GREEN">
              <type>
                <INT/>
              </type>
              <initialValue>
                <simpleValue value="5"/>
              </initialValue>
            </variable>
            <variable name="LID_BLUE">
              <type>
                <INT/>
              </type>
              <initialValue>
                <simpleValue value="2"/>
              </initialValue>
            </variable>
          </globalVars>
        </resource>
      </configuration>
    </configurations>
  </instances>
</project>
